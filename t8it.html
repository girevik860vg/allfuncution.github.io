<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Веб-лаунчер смартфона</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; margin: 20px; }
  video, audio, canvas { margin: 10px; max-width: 90%; border: 1px solid #ccc; }
  button { margin: 5px; padding: 10px; }
</style>
</head>
<body>

<h1>Веб-лаунчер смартфона</h1>

<!-- Видео стрим с камеры -->
<video id="camera" autoplay playsinline></video>
<canvas id="photoCanvas" style="display:none;"></canvas>

<!-- Кнопки для фото/видео -->
<button id="takePhoto">Сделать фото</button>
<button id="startVideo">Начать запись видео</button>
<button id="stopVideo">Остановить запись видео</button>
<button id="startAudio">Записать аудио</button>
<button id="stopAudio">Остановить аудио</button>

<!-- Воспроизведение записей -->
<video id="recordedVideo" controls></video>
<audio id="recordedAudio" controls></audio>

<!-- Видеозвонок -->
<h2>Видеозвонок</h2>
<video id="localVideo" autoplay playsinline muted></video>
<video id="remoteVideo" autoplay playsinline></video>

<script>
let cameraStream;
let mediaRecorder;
let recordedChunks = [];
let audioRecorder;
let audioChunks = [];

// Доступ к камере
async function initCamera() {
  cameraStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  document.getElementById('camera').srcObject = cameraStream;
  document.getElementById('localVideo').srcObject = cameraStream;
}
initCamera();

// Сделать фото
document.getElementById('takePhoto').onclick = () => {
  const canvas = document.getElementById('photoCanvas');
  const video = document.getElementById('camera');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  const dataURL = canvas.toDataURL('image/png');
  const link = document.createElement('a');
  link.href = dataURL;
  link.download = 'photo.png';
  link.click();
};

// Запись видео
document.getElementById('startVideo').onclick = () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(cameraStream);
  mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    document.getElementById('recordedVideo').src = URL.createObjectURL(blob);
  };
  mediaRecorder.start();
};

document.getElementById('stopVideo').onclick = () => mediaRecorder.stop();

// Запись аудио
document.getElementById('startAudio').onclick = async () => {
  const audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
  audioChunks = [];
  audioRecorder = new MediaRecorder(audioStream);
  audioRecorder.ondataavailable = e => audioChunks.push(e.data);
  audioRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: 'audio/webm' });
    document.getElementById('recordedAudio').src = URL.createObjectURL(blob);
  };
  audioRecorder.start();
};

document.getElementById('stopAudio').onclick = () => audioRecorder.stop();

// Видеозвонок (пример локальный)
let pc = new RTCPeerConnection();
pc.ontrack = event => document.getElementById('remoteVideo').srcObject = event.streams[0];
cameraStream.getTracks().forEach(track => pc.addTrack(track, cameraStream));

// Создаем оффер
async function startCall() {
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  console.log('Оффер для отправки на сервер signaling:', offer.sdp);
}
startCall();
</script>
</body>
</html>
